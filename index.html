<?php
   require 'aws.phar';

   use Aws\S3\S3Client;
   use Aws\Rekognition\RekognitionClient;
   use Aws\Rekognition\Exception\RekognitionException;
   use Aws\S3\Exception\S3Exception;
   use Aws\Exception\AwsException;

$bucket = 'aws-identifier-bucket';
$keyname = 'vikram.jpg';

//Create a S3Client
$s3 = new Aws\S3\S3Client([
    'version' => 'latest',
    'region' => 'ap-south-1'
]);
//Notice that we did not explicitly provide credentials to the client. That’s because the SDK should detect the credentials from environment variables
//When you use IAM roles, you don’t need to worry about credential management from your application. They allow an instance to “assume” a role by retrieving temporary credentials from the Amazon EC2 instance’s metadata server.

try {
    // Upload data.
	$result1 = $s3->putObject([
		'Bucket' 		=> $bucket,
		'Key'    		=> $keyname,
		'SourceFile'   	=> __DIR__. "/$keyname",
		'ACL'    		=> 'public-read-write'
	]);

    // Print the URL to the object.
	$imageUrl = $result1['ObjectURL'];
if($imageUrl){

$client = new RekognitionClient([
    'region'    => 'ap-south-1',
    'version'   => 'latest'
]);

$result2 = $client->detectFaces([
    'Image' => [
        'S3Object' => [
            'Bucket' => $bucket,
            'Name' => $keyname,
        ],
    ],
]);
echo "Totally there are ".count($result2["FaceDetails"])."faces";}
} catch (Exception $e) {
	echo $e->getMessage() . PHP_EOL;
}
?>